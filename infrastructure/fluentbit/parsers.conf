# Cerberus NGFW - Fluent Bit Parsers

# ============================================================================
# JSON Parser (default)
# ============================================================================
[PARSER]
    Name        json
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z

# ============================================================================
# Suricata EVE JSON Parser
# ============================================================================
[PARSER]
    Name        suricata_eve
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z

# ============================================================================
# Zeek TSV Log Parser
# ============================================================================
[PARSER]
    Name        zeek_tsv
    Format      regex
    Regex       ^(?<ts>[^\t]+)\t(?<uid>[^\t]*)\t(?<id_orig_h>[^\t]*)\t(?<id_orig_p>[^\t]*)\t(?<id_resp_h>[^\t]*)\t(?<id_resp_p>[^\t]*)\t(?<proto>[^\t]*)\t(?<service>[^\t]*)\t(?<duration>[^\t]*)\t(?<orig_bytes>[^\t]*)\t(?<resp_bytes>[^\t]*)\t(?<conn_state>[^\t]*)\t(?<local_orig>[^\t]*)\t(?<local_resp>[^\t]*)\t(?<missed_bytes>[^\t]*)\t(?<history>[^\t]*)\t(?<orig_pkts>[^\t]*)\t(?<orig_ip_bytes>[^\t]*)\t(?<resp_pkts>[^\t]*)\t(?<resp_ip_bytes>[^\t]*).*$
    Time_Key    ts
    Time_Format %s.%L

# ============================================================================
# Zeek DNS Log Parser
# ============================================================================
[PARSER]
    Name        zeek_dns
    Format      regex
    Regex       ^(?<ts>[^\t]+)\t(?<uid>[^\t]*)\t(?<id_orig_h>[^\t]*)\t(?<id_orig_p>[^\t]*)\t(?<id_resp_h>[^\t]*)\t(?<id_resp_p>[^\t]*)\t(?<proto>[^\t]*)\t(?<trans_id>[^\t]*)\t(?<rtt>[^\t]*)\t(?<query>[^\t]*)\t(?<qclass>[^\t]*)\t(?<qclass_name>[^\t]*)\t(?<qtype>[^\t]*)\t(?<qtype_name>[^\t]*)\t(?<rcode>[^\t]*)\t(?<rcode_name>[^\t]*)\t(?<AA>[^\t]*)\t(?<TC>[^\t]*)\t(?<RD>[^\t]*)\t(?<RA>[^\t]*)\t(?<Z>[^\t]*)\t(?<answers>[^\t]*)\t(?<TTLs>[^\t]*)\t(?<rejected>[^\t]*).*$
    Time_Key    ts
    Time_Format %s.%L

# ============================================================================
# Syslog Parser (for VPN logs)
# ============================================================================
[PARSER]
    Name        syslog
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
    Time_Key    time
    Time_Format %b %d %H:%M:%S

# ============================================================================
# Syslog RFC5424 Parser
# ============================================================================
[PARSER]
    Name        syslog_rfc5424
    Format      regex
    Regex       ^\<(?<pri>[0-9]{1,5})\>1 (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[^ ]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*?)\]|-)) (?<message>.+)$
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z

# ============================================================================
# WireGuard Log Parser
# ============================================================================
[PARSER]
    Name        wireguard
    Format      regex
    Regex       ^(?<timestamp>[^ ]+ [^ ]+) (?<level>[^:]+): (?<interface>[^:]+): (?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S

# ============================================================================
# StrongSwan/Charon Log Parser
# ============================================================================
[PARSER]
    Name        strongswan
    Format      regex
    Regex       ^(?<timestamp>[^ ]+) (?<level>[0-9]+)\[(?<thread>[^\]]+)\] (?<subsystem>[^:]+): (?<message>.*)$
    Time_Key    timestamp
    Time_Format %b %d %H:%M:%S

# ============================================================================
# OpenVPN Log Parser
# ============================================================================
[PARSER]
    Name        openvpn
    Format      regex
    Regex       ^(?<timestamp>[^ ]+ [^ ]+) (?<level>[A-Z]+) (?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S

# ============================================================================
# Nginx Access Log Parser
# ============================================================================
[PARSER]
    Name        nginx_access
    Format      regex
    Regex       ^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z

# ============================================================================
# Nginx Error Log Parser
# ============================================================================
[PARSER]
    Name        nginx_error
    Format      regex
    Regex       ^(?<time>[^ ]+ [^ ]+) \[(?<level>[^\]]+)\] (?<pid>[0-9]+)#(?<tid>[0-9]+): (\*(?<cid>[0-9]+) )?(?<message>.*)$
    Time_Key    time
    Time_Format %Y/%m/%d %H:%M:%S

# ============================================================================
# Docker JSON Log Parser
# ============================================================================
[PARSER]
    Name        docker
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z

# ============================================================================
# Envoy Access Log Parser (for ALB)
# ============================================================================
[PARSER]
    Name        envoy_access
    Format      json
    Time_Key    start_time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z

# ============================================================================
# Generic Timestamp Parser
# ============================================================================
[PARSER]
    Name        generic_timestamp
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?([+-]\d{2}:\d{2}|Z)?) (?<level>[A-Z]+) (?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
